import{aa as P,ag as g,ae as R,ac as I,Q as c,r as h,ai as B,av as N,o as U,l as F,q as a,w as o,F as k,aw as q,p as A,aj as D,ak as L,g as j,an as b,ax as M,ao as T}from"./index-04af70b1.js";import{E as C,a as Q}from"./el-form-item-04ace386.js";import{E as z}from"./el-input-09275e26.js";const G=n=>(D("data-v-60651e1f"),n=n(),L(),n),H=G(()=>j("h5",{style:{"text-align":"center"}},"設定資料",-1)),J={__name:"SettingView",setup(n){var f,_;const[d,y]=[g.useUserStore(),g.useAlertStore()],V=R(),{user:i}=I(d),t=c({phone:(f=i.value)==null?void 0:f.phone,email:(_=i.value)==null?void 0:_.email,password:"",ensurePassword:""}),w=h(),x=c({phone:[{required:!0,message:"Phone cannot be empty",trigger:"blur"},{max:20,message:"Length should be 5 to 20",trigger:["blur","change"]}],email:[{required:!0,message:"Email cannot be empty",trigger:"blur"},{max:40,message:"Length should be  40",trigger:["blur","change"]}],password:[{min:7,max:14,message:"Length should be 7 to 14",trigger:["blur","change"]}],ensurePassword:[{validator(p,s,e){return s!==t.password?t.password?e(new Error("Please input password again")):e(new Error("Please type password first")):e()},trigger:["blur","change"]}]}),u=h();async function v(){u.value.disabled=!0;const[,p]=await b(w.value.validate());if(!p)return u.value.disabled=!1;const s=d.userId,e=M(t);e.password||delete e.password,delete e.ensurePassword;const[r,m]=await b(T.user.updatePersonalData(s,e));if(u.value.disabled=!1,r)return y.show();d.formatAndStoreApiData(m),V.push("/")}return(p,s)=>{const e=z,r=C,m=B,S=Q,E=N;return U(),F(k,null,[H,a(E,{style:{"justify-content":"center"}},{default:o(()=>[a(S,{ref_key:"formRef",ref:w,onSubmit:q(v,["prevent"]),model:t,rules:x,"status-icon":"","label-position":"top"},{default:o(()=>[a(r,{label:"New phone",prop:"phone"},{default:o(()=>[a(e,{type:"text",modelValue:t.phone,"onUpdate:modelValue":s[0]||(s[0]=l=>t.phone=l),maxlength:"20"},null,8,["modelValue"])]),_:1}),a(r,{label:"New email",prop:"email"},{default:o(()=>[a(e,{type:"text",modelValue:t.email,"onUpdate:modelValue":s[1]||(s[1]=l=>t.email=l),maxlength:"40"},null,8,["modelValue"])]),_:1}),a(r,{label:"New password",prop:"password"},{default:o(()=>[a(e,{type:"password","show-password":"",modelValue:t.password,"onUpdate:modelValue":s[2]||(s[2]=l=>t.password=l),maxlength:"14"},null,8,["modelValue"])]),_:1}),a(r,{label:"Ensure new password",prop:"ensurePassword"},{default:o(()=>[a(e,{type:"password","show-password":"",modelValue:t.ensurePassword,"onUpdate:modelValue":s[3]||(s[3]=l=>t.ensurePassword=l),maxlength:"14"},null,8,["modelValue"])]),_:1}),a(r,null,{default:o(()=>[a(m,{round:"",ref_key:"submitButtonRef",ref:u,type:"primary","native-type":"submit"},{default:o(()=>[A(" 套用 ")]),_:1},512)]),_:1})]),_:1},8,["onSubmit","model","rules"])]),_:1})],64)}}},X=P(J,[["__scopeId","data-v-60651e1f"]]);export{X as default};
