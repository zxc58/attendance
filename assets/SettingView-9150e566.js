import{ab as P,ah as c,af as I,ad as R,Q as g,r as b,aj as N,aw as U,o as B,l as F,q as s,w as o,F as q,ax as A,p as D,ak as L,al as j,g as k,ao as h,ay as M,ap as T}from"./index-8f71c4f8.js";import{E as z,a as C}from"./el-form-item-9f3f3a6c.js";import{E as Q}from"./el-input-34c672c2.js";const G=n=>(L("data-v-b1ff7fc6"),n=n(),j(),n),H=G(()=>k("div",{style:{"font-size":"2rem","text-align":"center"}},"設定資料",-1)),J={__name:"SettingView",setup(n){var w,_;const[d,y]=[c.useUserStore(),c.useAlertStore()],V=I(),{user:i}=R(d),t=g({phone:(w=i.value)==null?void 0:w.phone,email:(_=i.value)==null?void 0:_.email,password:"",ensurePassword:""}),f=b(),v=g({phone:[{required:!0,message:"Phone cannot be empty",trigger:"blur"},{max:20,message:"Length should be 5 to 20",trigger:["blur","change"]}],email:[{required:!0,message:"Email cannot be empty",trigger:"blur"},{max:40,message:"Length should be  40",trigger:["blur","change"]}],password:[{min:7,max:14,message:"Length should be 7 to 14",trigger:["blur","change"]}],ensurePassword:[{validator(p,a,e){return a!==t.password?t.password?e(new Error("Please input password again")):e(new Error("Please type password first")):e()},trigger:["blur","change"]}]}),u=b(!1);async function x(){u.value=!0;const[,p]=await h(f.value.validate());if(!p)return u.value=!1;const a=d.userId,e=M(t);e.password||delete e.password,delete e.ensurePassword;const[r,m]=await h(T.user.updatePersonalData(a,e));if(u.value=!1,r)return y.show();d.formatAndStoreApiData(m),V.push("/")}return(p,a)=>{const e=Q,r=z,m=N,S=C,E=U;return B(),F(q,null,[H,s(E,{style:{"justify-content":"center"}},{default:o(()=>[s(S,{ref_key:"formRef",ref:f,onSubmit:A(x,["prevent"]),model:t,rules:v,"status-icon":"","label-position":"top"},{default:o(()=>[s(r,{label:"New phone",prop:"phone"},{default:o(()=>[s(e,{type:"text",modelValue:t.phone,"onUpdate:modelValue":a[0]||(a[0]=l=>t.phone=l),maxlength:"20"},null,8,["modelValue"])]),_:1}),s(r,{label:"New email",prop:"email"},{default:o(()=>[s(e,{type:"text",modelValue:t.email,"onUpdate:modelValue":a[1]||(a[1]=l=>t.email=l),maxlength:"40"},null,8,["modelValue"])]),_:1}),s(r,{label:"New password",prop:"password"},{default:o(()=>[s(e,{type:"password","show-password":"",modelValue:t.password,"onUpdate:modelValue":a[2]||(a[2]=l=>t.password=l),maxlength:"14"},null,8,["modelValue"])]),_:1}),s(r,{label:"Ensure new password",prop:"ensurePassword"},{default:o(()=>[s(e,{type:"password","show-password":"",modelValue:t.ensurePassword,"onUpdate:modelValue":a[3]||(a[3]=l=>t.ensurePassword=l),maxlength:"14"},null,8,["modelValue"])]),_:1}),s(r,null,{default:o(()=>[s(m,{round:"",disabled:u.value,type:"primary","native-type":"submit"},{default:o(()=>[D(" 套用 ")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["onSubmit","model","rules"])]),_:1})],64)}}},X=P(J,[["__scopeId","data-v-b1ff7fc6"]]);export{X as default};
